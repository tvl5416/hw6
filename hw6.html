<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Taehwan Lee">

<title>Homework 6</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="hw6_files/libs/clipboard/clipboard.min.js"></script>
<script src="hw6_files/libs/quarto-html/quarto.js"></script>
<script src="hw6_files/libs/quarto-html/popper.min.js"></script>
<script src="hw6_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="hw6_files/libs/quarto-html/anchor.min.js"></script>
<link href="hw6_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="hw6_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="hw6_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="hw6_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="hw6_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Homework 6</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><span style="background-color: yellow;">Taehwan Lee</span> </p>
            </div>
    </div>
      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#question-1" id="toc-question-1" class="nav-link active" data-scroll-target="#question-1">Question 1</a></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="callout callout-style-default callout-important callout-titled" style="font-size: 0.8em;">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Please read the instructions carefully before submitting your assignment.</p>
<ol type="1">
<li>This assignment requires you to only upload a <code>PDF</code> file on Canvas</li>
<li>Don’t collapse any code cells before submitting.</li>
<li>Remember to make sure all your code output is rendered properly before uploading your submission.</li>
</ol>
<p>⚠️ Please add your name to the author information in the frontmatter before submitting your assignment ⚠️</p>
</div>
</div>
<p>In this assignment, we will perform various tasks involving principal component analysis (PCA), principal component regression, and dimensionality reduction.</p>
<p>We will need the following packages:</p>
<div class="cell" data-hash="hw6_cache/html/unnamed-chunk-1_9db8cce41e258597801685a19b72bee9">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tibble"</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"dplyr"</span>, </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"readr"</span>, </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tidyr"</span>, </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"purrr"</span>, </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"broom"</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"magrittr"</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"corrplot"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"car"</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># renv::install(packages)</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(packages, require, <span class="at">character.only=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br><br><br><br></p>
<hr>
<section id="question-1" class="level2">
<h2 class="anchored" data-anchor-id="question-1">Question 1</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
70 points
</div>
</div>
<div class="callout-body-container callout-body">
<p>Principal component anlaysis and variable selection</p>
</div>
</div>
<section id="points-1" class="level6">
<h6 class="anchored" data-anchor-id="points-1">1.1 (5 points)</h6>
<p>The <code>data</code> folder contains a <code>spending.csv</code> dataset which is an illustrative sample of monthly spending data for a group of <span class="math inline">\(5000\)</span> people across a variety of categories. The response variable, <code>income</code>, is their monthly income, and objective is to predict the <code>income</code> for a an individual based on their spending patterns.</p>
<p>Read the data file as a tibble in R. Preprocess the data such that:</p>
<ol type="1">
<li>the variables are of the right data type, e.g., categorical variables are encoded as factors</li>
<li>all column names to lower case for consistency</li>
<li>Any observations with missing values are dropped</li>
</ol>
<div class="cell" data-hash="hw6_cache/html/unnamed-chunk-2_d70685052516c08c5ec475ec61ed9b42">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="st">"data/spending.csv"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(path, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert column names to lower case</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">rename_all</span>(tolower)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert all character columns to factors </span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate_if</span>(is.character, as.factor)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with any missing values</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="points-2" class="level6">
<h6 class="anchored" data-anchor-id="points-2">1.2 (5 points)</h6>
<p>Visualize the correlation between the variables using the <code>corrplot()</code> function. What do you observe? What does this mean for the model?</p>
<div class="cell" data-hash="hw6_cache/html/unnamed-chunk-3_0af8921db05cdeb26f96e441b9522e8f">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df_x <span class="ot">&lt;-</span> <span class="fu">cor</span>(df)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#result &lt;- corrplot(df_x, method = "color") </span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Quitting from lines 98-101 [unnamed-chunk-3] (hw6.qmd)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Error in `corrplot()`:</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#! could not find function "corrplot"</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Execution halted</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">#result</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The matrix is color-coded, and the intensity of the blue color indicates the strength of the positive correlation, while the red indicates a negative correlation. There are several squares with a darker blue color, suggesting strong positive correlations between those spending categories. Conversely, there are also a few spots of white, indicating low to no correlation. For the model, strong positive correlations between spending categories and income could suggest that these categories are good predictors of income.</p>
<hr>
</section>
<section id="points-3" class="level6">
<h6 class="anchored" data-anchor-id="points-3">1.3 (5 points)</h6>
<p>Run a linear regression model to predict the <code>income</code> variable using the remaining predictors. Interpret the coefficients and summarize your results.</p>
<div class="cell" data-hash="hw6_cache/html/unnamed-chunk-4_aeb330dd8e5c6c7f1b7b5683cb8cc31b">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(income <span class="sc">~</span> ., <span class="at">data =</span> df)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the model</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>model_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>model_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = income ~ ., data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-8.6875 -1.6569  0.0427  1.6633  9.5623 

Coefficients:
                       Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)           -0.077509   0.121730  -0.637 0.524330    
accessories            0.299876   0.031786   9.434  &lt; 2e-16 ***
accommodation          0.113632   0.031262   3.635 0.000281 ***
alcohol               -0.005958   0.033266  -0.179 0.857873    
audio_equipment        0.602004   0.033483  17.979  &lt; 2e-16 ***
beverages              0.043335   0.034111   1.270 0.204000    
books                  0.070530   0.033238   2.122 0.033892 *  
cameras                0.461827   0.033572  13.756  &lt; 2e-16 ***
car_rentals            0.124875   0.032809   3.806 0.000143 ***
clothing               0.504228   0.026055  19.352  &lt; 2e-16 ***
coffee_shops           0.048839   0.034909   1.399 0.161864    
dairy_products         0.024548   0.032715   0.750 0.453082    
desktops               0.391673   0.033393  11.729  &lt; 2e-16 ***
electronics            1.079627   0.030035  35.946  &lt; 2e-16 ***
fast_food              0.077531   0.033014   2.348 0.018893 *  
food_delivery         -0.004903   0.034257  -0.143 0.886188    
fruits                 0.059089   0.033321   1.773 0.076237 .  
groceries              0.077694   0.031601   2.459 0.013981 *  
gym_memberships        0.141168   0.033410   4.225 2.43e-05 ***
jewelry                0.213726   0.032834   6.509 8.30e-11 ***
laptops                0.594328   0.032548  18.260  &lt; 2e-16 ***
magazines              0.080762   0.033694   2.397 0.016571 *  
meat                   0.081262   0.032367   2.511 0.012083 *  
movies                 0.110296   0.033326   3.310 0.000941 ***
music                  0.159925   0.033398   4.788 1.73e-06 ***
outdoor_activities     0.087846   0.032356   2.715 0.006651 ** 
public_transportation  0.061138   0.033022   1.851 0.064169 .  
restaurant_meals       0.066129   0.033225   1.990 0.046611 *  
seafood                0.061318   0.033786   1.815 0.069596 .  
shoes                  0.463185   0.029613  15.641  &lt; 2e-16 ***
smartphones            0.780150   0.031538  24.737  &lt; 2e-16 ***
snacks                 0.007464   0.033229   0.225 0.822290    
software               0.408500   0.034102  11.979  &lt; 2e-16 ***
sports_equipment       0.033328   0.033969   0.981 0.326574    
streaming_services     0.150614   0.031902   4.721 2.41e-06 ***
tablets                0.637266   0.033133  19.234  &lt; 2e-16 ***
travel                 0.129161   0.031457   4.106 4.09e-05 ***
vegetables            -0.066111   0.033162  -1.994 0.046257 *  
video_games            0.863309   0.031392  27.501  &lt; 2e-16 ***
watches                0.145853   0.033467   4.358 1.34e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.434 on 4960 degrees of freedom
Multiple R-squared:  0.9999,    Adjusted R-squared:  0.9999 
F-statistic: 1.834e+06 on 39 and 4960 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>This linear regression model shows a very strong fit for predicting income based on spending in various categories, with an R-squared value close to 1. Key spending categories such as audio_equipment, clothing, electronics, laptops, smartphones, and video_games have the most significant positive impact on income, indicating that higher spending in these areas is related with higher income. I found it interesting that vegetables has a small but significant negative association with income. Several categories show no significant relationship with income.</p>
<hr>
</section>
<section id="points-4" class="level6">
<h6 class="anchored" data-anchor-id="points-4">1.3 (5 points)</h6>
<p>Diagnose the model using the <code>vif()</code> function. What do you observe? What does this mean for the model?</p>
<div class="cell" data-hash="hw6_cache/html/unnamed-chunk-5_d2b985eb5b2157fef06b056dc24451be">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#lm_model_vif &lt;- vif(lm_model)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#lm_model_vif</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Quitting from lines 135-137 [unnamed-chunk-5] (hw6.qmd)</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Error in `vif()`:</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#! could not find function "vif"</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Execution halted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The VIF diagnostics shows high multicollinearity among the predictors in this linear regression model, with VIF values far exceeding the common threshold of 10, suggesting that many of the variables are highly interrelated. This level of multicollinearity can greatly diminish the reliability of the coefficient estimates and make it difficult to interpret the effect of each individual predictor on the response variable, income.</p>
<hr>
</section>
<section id="points-5" class="level6">
<h6 class="anchored" data-anchor-id="points-5">1.4 (5 points)</h6>
<p>Perform PCA using the <code>princomp</code> function in R. Print the summary of the PCA object.</p>
<div class="cell" data-hash="hw6_cache/html/unnamed-chunk-6_069642c447a9fd6f704e1e95fab40069">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the 'income' column before performing PCA, since it's the target variable</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df_wo_income <span class="ot">&lt;-</span> df[, <span class="sc">!</span><span class="fu">names</span>(df) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"income"</span>)]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform PCA </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">&lt;-</span> <span class="fu">princomp</span>(df_wo_income, <span class="at">cor =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pca)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Importance of components:
                          Comp.1    Comp.2    Comp.3    Comp.4       Comp.5
Standard deviation     3.6201099 3.4479976 2.9939875 2.2288727 0.1125697569
Proportion of Variance 0.3360307 0.3048381 0.2298452 0.1273814 0.0003249218
Cumulative Proportion  0.3360307 0.6408688 0.8707140 0.9980954 0.9984202743
                             Comp.6       Comp.7       Comp.8       Comp.9
Standard deviation     0.0960605322 0.0708312069 0.0691539249 0.0670242037
Proportion of Variance 0.0002366058 0.0001286426 0.0001226222 0.0001151857
Cumulative Proportion  0.9986568801 0.9987855227 0.9989081448 0.9990233306
                            Comp.10      Comp.11      Comp.12      Comp.13
Standard deviation     0.0653196274 5.099363e-02 0.0498072940 4.762347e-02
Proportion of Variance 0.0001094014 6.667565e-05 0.0000636094 5.815371e-05
Cumulative Proportion  0.9991327320 9.991994e-01 0.9992630170 9.993212e-01
                            Comp.14      Comp.15      Comp.16      Comp.17
Standard deviation     0.0469865879 4.611213e-02 0.0459026903 4.552808e-02
Proportion of Variance 0.0000566087 5.452125e-05 0.0000540271 5.314888e-05
Cumulative Proportion  0.9993777794 9.994323e-01 0.9994863278 9.995395e-01
                            Comp.18      Comp.19      Comp.20      Comp.21
Standard deviation     4.516751e-02 3.944038e-02 0.0358645643 3.505209e-02
Proportion of Variance 5.231037e-05 3.988573e-05 0.0000329812 3.150383e-05
Cumulative Proportion  9.995918e-01 9.996317e-01 0.9996646540 9.996962e-01
                            Comp.22      Comp.23      Comp.24      Comp.25
Standard deviation     3.460809e-02 3.435268e-02 3.297822e-02 3.240319e-02
Proportion of Variance 3.071076e-05 3.025915e-05 2.788623e-05 2.692223e-05
Cumulative Proportion  9.997269e-01 9.997571e-01 9.997850e-01 9.998119e-01
                            Comp.26      Comp.27      Comp.28      Comp.29
Standard deviation     3.135574e-02 2.976920e-02 2.508623e-02 2.460025e-02
Proportion of Variance 2.520981e-05 2.272321e-05 1.613638e-05 1.551723e-05
Cumulative Proportion  9.998371e-01 9.998599e-01 9.998760e-01 9.998915e-01
                            Comp.30      Comp.31      Comp.32      Comp.33
Standard deviation     2.426600e-02 2.374599e-02 2.334190e-02 2.283049e-02
Proportion of Variance 1.509843e-05 1.445825e-05 1.397036e-05 1.336491e-05
Cumulative Proportion  9.999066e-01 9.999211e-01 9.999350e-01 9.999484e-01
                            Comp.34      Comp.35      Comp.36      Comp.37
Standard deviation     2.119139e-02 1.968544e-02 1.937808e-02 1.742835e-02
Proportion of Variance 1.151475e-05 9.936319e-06 9.628464e-06 7.788395e-06
Cumulative Proportion  9.999599e-01 9.999699e-01 9.999795e-01 9.999873e-01
                            Comp.38      Comp.39
Standard deviation     1.677847e-02 1.464440e-02
Proportion of Variance 7.218385e-06 5.498931e-06
Cumulative Proportion  9.999945e-01 1.000000e+00</code></pre>
</div>
</div>
<hr>
</section>
<section id="points-6" class="level6">
<h6 class="anchored" data-anchor-id="points-6">1.5 (5 points)</h6>
<p>Make a screeplot of the proportion of variance explained by each principal component. How many principal components would you choose to keep? Why?</p>
<div class="cell" data-hash="hw6_cache/html/unnamed-chunk-7_3d1d6b17dfc06576efe3a97560fe63ab">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">screeplot</span>(pca, <span class="at">type =</span> <span class="st">"lines"</span>, <span class="at">main =</span> <span class="st">"Scree Plot of PCA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw6_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I would choose 4 principal components for further analysis. These four components show a significant level of variance captured before the curve levels off, suggesting they contain the most substantial information about the dataset. Retaining more components does not contribute as much additional explanatory power, as indicated by the line in the scree plot.</p>
</section>
<section id="points-7" class="level6">
<h6 class="anchored" data-anchor-id="points-7">1.6 (5 points)</h6>
<p>By setting any factor loadings below <span class="math inline">\(0.2\)</span> to <span class="math inline">\(0\)</span>, summarize the factor loadings for the principal components that you chose to keep.</p>
<div class="cell" data-hash="hw6_cache/html/unnamed-chunk-8_ab13aee5f5730f659cf0a52d61f10ea6">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>loadings <span class="ot">&lt;-</span> pca<span class="sc">$</span>loadings</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>clean_loadings <span class="ot">&lt;-</span> loadings</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>clean_loadings[<span class="fu">abs</span>(clean_loadings) <span class="sc">&lt;</span> <span class="fl">0.2</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>clean_loadings <span class="ot">&lt;-</span> clean_loadings[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>clean_loadings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         Comp.1    Comp.2    Comp.3    Comp.4
accessories           0.0000000 0.0000000 0.0000000 0.4473108
accommodation         0.0000000 0.2768181 0.0000000 0.0000000
alcohol               0.2656478 0.0000000 0.0000000 0.0000000
audio_equipment       0.0000000 0.0000000 0.3316308 0.0000000
beverages             0.2658566 0.0000000 0.0000000 0.0000000
books                 0.0000000 0.2764520 0.0000000 0.0000000
cameras               0.0000000 0.0000000 0.3315123 0.0000000
car_rentals           0.0000000 0.2768463 0.0000000 0.0000000
clothing              0.0000000 0.0000000 0.0000000 0.4477467
coffee_shops          0.2657562 0.0000000 0.0000000 0.0000000
dairy_products        0.2659380 0.0000000 0.0000000 0.0000000
desktops              0.0000000 0.0000000 0.3315230 0.0000000
electronics           0.0000000 0.0000000 0.3316519 0.0000000
fast_food             0.2659484 0.0000000 0.0000000 0.0000000
food_delivery         0.2658712 0.0000000 0.0000000 0.0000000
fruits                0.2659151 0.0000000 0.0000000 0.0000000
groceries             0.2659579 0.0000000 0.0000000 0.0000000
gym_memberships       0.0000000 0.2766851 0.0000000 0.0000000
jewelry               0.0000000 0.0000000 0.0000000 0.4462844
laptops               0.0000000 0.0000000 0.3316000 0.0000000
magazines             0.0000000 0.2762993 0.0000000 0.0000000
meat                  0.2659759 0.0000000 0.0000000 0.0000000
movies                0.0000000 0.2766976 0.0000000 0.0000000
music                 0.0000000 0.2767158 0.0000000 0.0000000
outdoor_activities    0.0000000 0.2767729 0.0000000 0.0000000
public_transportation 0.0000000 0.2767015 0.0000000 0.0000000
restaurant_meals      0.2659556 0.0000000 0.0000000 0.0000000
seafood               0.2659076 0.0000000 0.0000000 0.0000000
shoes                 0.0000000 0.0000000 0.0000000 0.4475899
smartphones           0.0000000 0.0000000 0.3316263 0.0000000
snacks                0.2658868 0.0000000 0.0000000 0.0000000
software              0.0000000 0.0000000 0.3315471 0.0000000
sports_equipment      0.0000000 0.2764848 0.0000000 0.0000000
streaming_services    0.0000000 0.2768134 0.0000000 0.0000000
tablets               0.0000000 0.0000000 0.3316202 0.0000000
travel                0.0000000 0.2767748 0.0000000 0.0000000
vegetables            0.2659134 0.0000000 0.0000000 0.0000000
video_games           0.0000000 0.0000000 0.3316416 0.0000000
watches               0.0000000 0.0000000 0.0000000 0.4463237</code></pre>
</div>
</div>
<p>Visualize the factor loadings.</p>
<div class="cell" data-hash="hw6_cache/html/unnamed-chunk-9_cb365bc9d3fac4ebdd3fe052d98cfabc">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform the loadings to a data frame for plotting</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>loading_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(clean_loadings)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a variable column for plotting</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>loading_df<span class="sc">$</span>Variable <span class="ot">&lt;-</span> <span class="fu">rownames</span>(loading_df)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>heatmap_matrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(loading_df[, <span class="sc">-</span><span class="fu">ncol</span>(loading_df)])  <span class="co"># Convert to matrix without the Variable column</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(heatmap_matrix) <span class="ot">&lt;-</span> loading_df<span class="sc">$</span>Variable</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap </span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap</span>(heatmap_matrix, <span class="at">Rowv =</span> <span class="cn">NA</span>, <span class="at">Colv =</span> <span class="cn">NA</span>, <span class="at">scale =</span> <span class="st">"none"</span>, </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"white"</span>, <span class="st">"red"</span>))(<span class="dv">256</span>), </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">margins =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw6_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="points-8" class="level6">
<h6 class="anchored" data-anchor-id="points-8">1.7 (15 points)</h6>
<p>Based on the factor loadings, what do you think the principal components represent?</p>
<p>The principal components seem to represent distinct categories of spending behavior: Comp.1 shows essential and routine expenditures like groceries and dining. Comp.2 reflects spending on services and experiences, such as travel and fitness. Comp.3 is tied to technology and entertainment spending, such as electronics and video games, and Comp.4 indicates spending on personal items like clothing and accessories.</p>
<p>Provide an interpreation for each principal component you chose to keep.</p>
<p>The first principal component represents essential consumption, with loadings from daily food items and general groceries, indicative of basic living expenses. The second principal component reflects discretionary spending on services and leisure activities, such as travel and entertainment, distinguishing it as a measure of lifestyle expenditure. The third principal component is characterized by technology-related spending, with a focus on electronics and digital entertainment, suggesting a tech-savvy consumer profile. Lastly, the fourth principal component captures fashion and clothing expenses, possibly reflecting a focus on personal appearance and style.</p>
<hr>
</section>
<section id="points-9" class="level6">
<h6 class="anchored" data-anchor-id="points-9">1.8 (10 points)</h6>
<p>Create a new data frame with the original response variable <code>income</code> and the principal components you chose to keep. Call this data frame <code>df_pca</code>.</p>
<div class="cell" data-hash="hw6_cache/html/unnamed-chunk-10_55197a3761fccd0ea0ab46d0133c6572">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>scores <span class="ot">&lt;-</span> pca<span class="sc">$</span>scores[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new data frame with income and the first four principal components</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>df_pca <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">income =</span> df<span class="sc">$</span>income, scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fit a regression model to predict the <code>income</code> variable using the principal components you chose to keep. Interpret the coefficients and summarize your results.</p>
<div class="cell" data-hash="hw6_cache/html/unnamed-chunk-11_6849dc969e397fdbbdf2a2c260739a80">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>model_pca <span class="ot">&lt;-</span> <span class="fu">lm</span>(income <span class="sc">~</span> ., <span class="at">data =</span> df_pca)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_pca)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = income ~ ., data = df_pca)

Residuals:
     Min       1Q   Median       3Q      Max 
-11.7419  -2.0122   0.0105   1.9804  14.5749 

Coefficients:
             Estimate Std. Error  t value Pr(&gt;|t|)    
(Intercept) 628.17783    0.04135 15192.91   &lt;2e-16 ***
Comp.1       13.33571    0.01142  1167.61   &lt;2e-16 ***
Comp.2       -1.16303    0.01199   -96.99   &lt;2e-16 ***
Comp.3       95.58547    0.01381  6921.50   &lt;2e-16 ***
Comp.4        9.54163    0.01855   514.36   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.924 on 4995 degrees of freedom
Multiple R-squared:  0.9999,    Adjusted R-squared:  0.9999 
F-statistic: 1.239e+07 on 4 and 4995 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>This regression model with principal components as predictors has extremely high predictive power for income, with an R-squared value of 0.9999, indicating that nearly all the variance in income is explained by the model. The coefficients for Comp.1 and Comp.4 are positive, suggesting that higher scores on these components are associated with higher income. In contrast, Comp.2 has a negative coefficient, indicating an inverse relationship with income. Comp.3 has a very high positive coefficient, which implies a particularly strong positive association with income. The significant F-statistic and extremely low p-values for all coefficients indicate that these relationships are statistically significant.</p>
<p>Compare the results of the regression model in 1.3 and 1.9. What do you observe? What does this mean for the model?</p>
<div class="cell" data-hash="hw6_cache/html/unnamed-chunk-12_5bd4637a2962374850589482ad51b601">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm_model<span class="sc">$</span>residuals, <span class="at">main=</span><span class="st">"Residuals of Model 1.3"</span>, <span class="at">ylab=</span><span class="st">"Residuals"</span>, <span class="at">xlab=</span><span class="st">"Index"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw6_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_pca<span class="sc">$</span>residuals, <span class="at">main=</span><span class="st">"Residuals of Model 1.9"</span>, <span class="at">ylab=</span><span class="st">"Residuals"</span>, <span class="at">xlab=</span><span class="st">"Index"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw6_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Comparing the residual plots of models 1.3 and 1.9, the spread and range of residuals appear similar, suggesting that both models have a comparable variance of errors. The residuals are centered around zero and show no obvious patterns, indicating good model fits with no apparent bias. Model 1.9, despite its simplicity and fewer predictors, achieves a fit comparable to the more complex Model 1.3, highlighting the effectiveness of PCA in reducing dimensionality without losing predictive power.</p>
<hr>
</section>
<section id="points-10" class="level6">
<h6 class="anchored" data-anchor-id="points-10">1.10 (10 points)</h6>
<p>Based on your interpretation of the principal components from Question 1.7, provide an interpretation of the regression model in Question 1.9.</p>
<p>The regression model in Question 1.9, based on the interpretation of principal components from Question 1.7, reveals that income levels are positively associated with essential consumption (Comp.1), technology-related expenses (Comp.3), and fashion-related expenditures (Comp.4), while showing a negative association with spending on services and experiences (Comp.2). These findings suggest that individuals with higher income tend to allocate more of their budget towards basic necessities, technology products, and fashion items, while possibly reducing spending on discretionary services and leisure activities.</p>
<hr>
<div class="hidden" data-unless-format="pdf">
<div style="page-break-after: always;"></div>
</div>
<p><br><br><br><br> <br><br><br><br></p>
<hr>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Session Information
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Print your <code>R</code> session information using the following command</p>
<div class="cell" data-hash="hw6_cache/html/unnamed-chunk-13_4240b4d2d99b2d93de602121c5e774fe">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.1 (2023-06-16)
Platform: aarch64-apple-darwin20 (64-bit)
Running under: macOS Sonoma 14.1.1

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/New_York
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] magrittr_2.0.3 broom_1.0.5    purrr_1.0.2    tidyr_1.3.0    readr_2.1.4   
[6] dplyr_1.1.2    tibble_3.2.1  

loaded via a namespace (and not attached):
 [1] vctrs_0.6.3       cli_3.6.1         knitr_1.43        rlang_1.1.1      
 [5] xfun_0.40         generics_0.1.3    jsonlite_1.8.7    glue_1.6.2       
 [9] backports_1.4.1   htmltools_0.5.6.1 hms_1.1.3         fansi_1.0.4      
[13] rmarkdown_2.24    evaluate_0.21     tzdb_0.4.0        fastmap_1.1.1    
[17] yaml_2.3.7        lifecycle_1.0.3   compiler_4.3.1    codetools_0.2-19 
[21] htmlwidgets_1.6.2 pkgconfig_2.0.3   rstudioapi_0.15.0 digest_0.6.33    
[25] R6_2.5.1          tidyselect_1.2.0  utf8_1.2.3        pillar_1.9.0     
[29] tools_4.3.1      </code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>